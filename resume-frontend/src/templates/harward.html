<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ name | default('Your Name') }} — Resume</title>
  <style>
    html, body { height: 100%; }
    body { margin: 16px; padding: 16px; background: #fff; box-sizing: border-box; }
  </style>
</head>
<body>

{# ============ MACROS ============ #}
{% macro section_profile() %}
{% if profile and (profile.summary or profile.key_skills or profile.highest_degree) %}
<section class="resume-section no-break">
  <h2 class="section-title">Profile</h2>
  {% if profile.summary %}
    <p class="mb-2">{{ profile.summary }}</p>
  {% endif %}
  {% if profile.key_skills %}
    <div class="fw-semibold">Key Skills</div>
    <ul class="pill-list">
      {% for s in (profile.key_skills | default([])) %}
        <li class="pill">{{ s }}</li>
      {% endfor %}
    </ul>
  {% endif %}
  {% if profile.highest_degree %}
    <div class="muted-line mt-2">{{ profile.highest_degree }}</div>
  {% endif %}
</section>
{% endif %}
{% endmacro %}

{% macro section_education() %}
{% if education and (education | length) > 0 %}
<section class="resume-section no-break">
  <h2 class="section-title">Education</h2>
  {% for ed in education %}
    {% if ed and (ed.education or ed.date or ed.description) %}
    <div class="item">
      <div class="item-header">
        <div class="item-left fw-semibold">{{ ed.education | default('') }}</div>
        {% if ed.date %}
          <div class="item-right text-muted">{{ ed.date }}</div>
        {% endif %}
      </div>
      {% if ed.description %}
        <ul class="bullets"><li>{{ ed.description }}</li></ul>
      {% endif %}
    </div>
    {% endif %}
  {% endfor %}
</section>
{% endif %}
{% endmacro %}

{% macro section_experience() %}
{% if experience and (experience | length) > 0 %}
<section class="resume-section no-break">
  <h2 class="section-title">Experience</h2>
  {% for ex in experience %}
    {% if ex and (ex.position_or_company or ex.date or ex.description) %}
    <div class="item">
      <div class="item-header">
        <div class="item-left fw-semibold">{{ ex.position_or_company | default('') }}</div>
        {% if ex.date %}
          <div class="item-right text-muted">{{ ex.date }}</div>
        {% endif %}
      </div>
      {% if ex.description %}
        <ul class="bullets"><li>{{ ex.description }}</li></ul>
      {% endif %}
    </div>
    {% endif %}
  {% endfor %}
</section>
{% endif %}
{% endmacro %}

{% macro section_skills() %}
{% if skills and skills.sections %}
<section class="resume-section no-break">
  <h2 class="section-title">Skills</h2>
  {% for sec in (skills.sections | default([])) %}
    {% if sec.label %}
      <div class="fw-semibold">{{ sec.label }}</div>
    {% endif %}
    {% set items = sec.items | default([]) %}
    {% if items and (items | length) > 0 %}
      <ul class="pill-list">
        {% for it in items %}
          <li class="pill">{{ it }}</li>
        {% endfor %}
      </ul>
    {% endif %}
    {% if sec.note %}
      <div class="muted-line mt-1">{{ sec.note }}</div>
    {% endif %}
    {% if not loop.last %}
      <div class="mb-1"></div>
    {% endif %}
  {% endfor %}
</section>
{% endif %}
{% endmacro %}

{% macro section_references() %}
{% if references and (references | length) > 0 %}
<section class="resume-section no-break">
  <h2 class="section-title">References</h2>
  <ul class="bullets">
    {% for ref in references %}
      <li>
        {% if ref.name %}<strong>{{ ref.name }}</strong>{% endif %}
        {% if ref.relationship_or_title %} — {{ ref.relationship_or_title }}{% endif %}
        {% if ref.contact %} — <a href="mailto:{{ ref.contact }}">{{ ref.contact }}</a>{% endif %}
      </li>
    {% endfor %}
  </ul>
</section>
{% endif %}
{% endmacro %}

{% macro section_custom_one(sec) %}
{% if sec and (sec.label or (sec.items and sec.items | length) > 0) %}
<section class="resume-section no-break">
  <h2 class="section-title">{{ sec.label or 'Custom' }}</h2>
  {% for it in (sec.items or []) %}
    {% if it.title or it.date or it.description %}
    <div class="item">
      <div class="item-header">
        <div class="item-left fw-semibold">{{ it.title or '' }}</div>
        {% if it.date %}
          <div class="item-right text-muted">{{ it.date }}</div>
        {% endif %}
      </div>
      {% if it.description %}
        <ul class="bullets"><li>{{ it.description }}</li></ul>
      {% endif %}
    </div>
    {% endif %}
  {% endfor %}
</section>
{% endif %}
{% endmacro %}

{# ============ PAGE ============ #}
<main class="page container-fluid">

  <!-- Header -->
  <header class="resume-header">
    <div class="d-flex flex-column flex-lg-row justify-content-between align-items-lg-end gap-2">
      <div>
        <h1 class="m-0 fw-bold">{{ name | default('Your Name') }}</h1>
        {% set subtitle = title or (profile and profile.job_title) %}
        {% if subtitle %}
          <div class="subtitle text-muted">{{ subtitle }}</div>
        {% endif %}
      </div>

      {% if contacts and (contacts.email or contacts.phone or contacts.github or contacts.linkedin or contacts.location) %}
      <ul class="contact list-inline m-0 small text-muted">
        {% if contacts.email %}<li class="list-inline-item">{{ contacts.email }}</li>{% endif %}
        {% if contacts.phone %}<li class="list-inline-item">{{ contacts.phone }}</li>{% endif %}
        {% if contacts.github %}<li class="list-inline-item">{{ contacts.github }}</li>{% endif %}
        {% if contacts.linkedin %}<li class="list-inline-item">{{ contacts.linkedin }}</li>{% endif %}
        {% if contacts.location %}<li class="list-inline-item">{{ contacts.location }}</li>{% endif %}
      </ul>
      {% endif %}
    </div>
  </header>

  {# Ordered Sections (default includes three custom sections) #}
{% set order_list = order or ['profile','skills','education','experience','references'] %}

{# Ordered Sections #}

{% for key in order_list %}
  {% if key == 'profile' %}
    {{ section_profile() }}
  {% elif key == 'education' %}
    {{ section_education() }}
  {% elif key == 'experience' %}
    {{ section_experience() }}
  {% elif key == 'skills' %}
    {{ section_skills() }}
  {% elif key == 'references' %}
    {{ section_references() }}
  {% elif key and (key.indexOf('custom:') == 0) %}
    {% set idx = key | replace('custom:', '') | int %}
    {% if custom_sections and custom_sections[idx] is defined %}
      {{ section_custom_one(custom_sections[idx]) }}
    {% endif %}
  {% endif %}
{% endfor %}

</main>
</body>
</html>
